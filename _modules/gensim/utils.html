

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>gensim.utils</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="" href="../../index.html"/>
        <link rel="up" title="gensim" href="../gensim.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> NLP APIs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gensim_tutorial/tutorial.html">Gensim Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nltk_intro.html">Natural Language Toolkit</a></li>
</ul>
<p class="caption"><span class="caption-text">Autogenerated API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.html"><code class="docutils literal"><span class="pre">gensim</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.interfaces.html"><code class="docutils literal"><span class="pre">gensim.interfaces</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.matutils.html"><code class="docutils literal"><span class="pre">gensim.matutils</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.utils.html"><code class="docutils literal"><span class="pre">gensim.utils</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/simserver.html"><code class="docutils literal"><span class="pre">simserver</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/word2vec.html"><code class="docutils literal"><span class="pre">word2vec</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/stop_words.html"><code class="docutils literal"><span class="pre">stop_words</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/nltk.classify.html"><code class="docutils literal"><span class="pre">nltk.classify</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/nltk.cluster.html"><code class="docutils literal"><span class="pre">nltk.cluster</span></code></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NLP APIs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../gensim.html">gensim</a> &raquo;</li>
        
      <li>gensim.utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gensim.utils</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2010 Radim Rehurek &lt;radimrehurek@seznam.cz&gt;</span>
<span class="c1"># Licensed under the GNU LGPL v2.1 - http://www.gnu.org/licenses/lgpl.html</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains various general utility functions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">html.entities</span> <span class="kn">import</span> <span class="n">name2codepoint</span> <span class="k">as</span> <span class="n">n2cp</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">htmlentitydefs</span> <span class="kn">import</span> <span class="n">name2codepoint</span> <span class="k">as</span> <span class="n">n2cp</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">_pickle</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span> <span class="kn">as</span> <span class="nn">_pickle</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>  <span class="c1"># for `synchronous` function lock</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">string_types</span><span class="p">,</span> <span class="nb">unichr</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">xrange</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">smart_open</span> <span class="kn">import</span> <span class="n">smart_open</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart_open library not found; falling back to local-filesystem-only&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_closing</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add support for `with Base(attrs) as fout:` to the base class if it&#39;s missing.</span>
<span class="sd">        The base class&#39; `close()` method will be called on context exit, to always close the file properly.</span>

<span class="sd">        This is needed for gzip.GzipFile, bz2.BZ2File etc in older Pythons (&lt;=2.6), which otherwise</span>
<span class="sd">        raise &quot;AttributeError: GzipFile instance has no attribute &#39;__exit__&#39;&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;__enter__&#39;</span><span class="p">):</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__enter__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;__exit__&#39;</span><span class="p">):</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__exit__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Closing&#39;</span> <span class="o">+</span> <span class="n">base</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">smart_open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.bz2&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">bz2</span> <span class="kn">import</span> <span class="n">BZ2File</span>
            <span class="k">return</span> <span class="n">make_closing</span><span class="p">(</span><span class="n">BZ2File</span><span class="p">)(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.gz&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">gzip</span> <span class="kn">import</span> <span class="n">GzipFile</span>
            <span class="k">return</span> <span class="n">make_closing</span><span class="p">(</span><span class="n">GzipFile</span><span class="p">)(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>


<span class="n">PAT_ALPHABETIC</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(((?![\d])\w)+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
<span class="n">RE_HTML_ENTITY</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;&amp;(#?)([xX]?)(\w{1,8});&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>



<div class="viewcode-block" id="synchronous"><a class="viewcode-back" href="../../generated/generated/gensim.utils.synchronous.html#gensim.interfaces.synchronous">[docs]</a><span class="k">def</span> <span class="nf">synchronous</span><span class="p">(</span><span class="n">tlockname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A decorator to place an instance-based lock around a method.</span>

<span class="sd">    Adapted from http://code.activestate.com/recipes/577105-synchronization-decorator-for-class-methods/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_synched</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_synchronizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">tlock</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tlockname</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;acquiring lock </span><span class="si">%r</span><span class="s2"> for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tlockname</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

            <span class="k">with</span> <span class="n">tlock</span><span class="p">:</span> <span class="c1"># use lock as a context manager to perform safe acquire/release pairs</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;acquired lock </span><span class="si">%r</span><span class="s2"> for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tlockname</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;releasing lock </span><span class="si">%r</span><span class="s2"> for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tlockname</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">_synchronizer</span>
    <span class="k">return</span> <span class="n">_synched</span></div>


<div class="viewcode-block" id="NoCM"><a class="viewcode-back" href="../../generated/generated/gensim.utils.NoCM.html#gensim.interfaces.NoCM">[docs]</a><span class="k">class</span> <span class="nc">NoCM</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="NoCM.acquire"><a class="viewcode-back" href="../../generated/generated/gensim.utils.NoCM.acquire.html#gensim.interfaces.NoCM.acquire">[docs]</a>    <span class="k">def</span> <span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NoCM.release"><a class="viewcode-back" href="../../generated/generated/gensim.utils.NoCM.release.html#gensim.interfaces.NoCM.release">[docs]</a>    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">pass</span></div>
<span class="n">nocm</span> <span class="o">=</span> <span class="n">NoCM</span><span class="p">()</span>


<span class="nd">@contextmanager</span>
<div class="viewcode-block" id="file_or_filename"><a class="viewcode-back" href="../../generated/generated/gensim.utils.file_or_filename.html#gensim.interfaces.file_or_filename">[docs]</a><span class="k">def</span> <span class="nf">file_or_filename</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a file-like object ready to be read from the beginning. `input` is either</span>
<span class="sd">    a filename (gz/bz2 also supported) or a file-like object supporting seek.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
        <span class="c1"># input was a filename: open as file</span>
        <span class="k">yield</span> <span class="n">smart_open</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># input already a file-like object; just reset to the beginning</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">yield</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="deaccent"><a class="viewcode-back" href="../../generated/generated/gensim.utils.deaccent.html#gensim.interfaces.deaccent">[docs]</a><span class="k">def</span> <span class="nf">deaccent</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove accentuation from the given string. Input text is either a unicode string or utf8 encoded bytestring.</span>

<span class="sd">    Return input string with accents removed, as unicode.</span>

<span class="sd">    &gt;&gt;&gt; deaccent(&quot;Šéf chomutovských komunistů dostal poštou bílý prášek&quot;)</span>
<span class="sd">    u&#39;Sef chomutovskych komunistu dostal postou bily prasek&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="c1"># assume utf8 for byte strings, use default (strict) error handling</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFD&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">norm</span> <span class="k">if</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Mn&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFC&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="copytree_hardlink"><a class="viewcode-back" href="../../generated/generated/gensim.utils.copytree_hardlink.html#gensim.interfaces.copytree_hardlink">[docs]</a><span class="k">def</span> <span class="nf">copytree_hardlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively copy a directory ala shutils.copytree, but hardlink files</span>
<span class="sd">    instead of copying. Available on UNIX systems only.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">copy2</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">link</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span> <span class="o">=</span> <span class="n">copy2</span></div>


<div class="viewcode-block" id="tokenize"><a class="viewcode-back" href="../../generated/generated/gensim.utils.tokenize.html#gensim.interfaces.tokenize">[docs]</a><span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lowercase</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">deacc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="n">to_lower</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iteratively yield tokens as unicode strings, removing accent marks</span>
<span class="sd">    and optionally lowercasing the unidoce string by assigning True</span>
<span class="sd">    to one of the parameters, lowercase, to_lower, or lower.</span>

<span class="sd">    Input text may be either unicode or utf8-encoded byte string.</span>

<span class="sd">    The tokens on output are maximal contiguous sequences of alphabetic</span>
<span class="sd">    characters (no digits!).</span>

<span class="sd">    &gt;&gt;&gt; list(tokenize(&#39;Nic nemůže letět rychlostí vyšší, než 300 tisíc kilometrů za sekundu!&#39;, deacc = True))</span>
<span class="sd">    [u&#39;Nic&#39;, u&#39;nemuze&#39;, u&#39;letet&#39;, u&#39;rychlosti&#39;, u&#39;vyssi&#39;, u&#39;nez&#39;, u&#39;tisic&#39;, u&#39;kilometru&#39;, u&#39;za&#39;, u&#39;sekundu&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lowercase</span> <span class="o">=</span> <span class="n">lowercase</span> <span class="ow">or</span> <span class="n">to_lower</span> <span class="ow">or</span> <span class="n">lower</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lowercase</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">deacc</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">deaccent</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">PAT_ALPHABETIC</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span></div>


<div class="viewcode-block" id="simple_preprocess"><a class="viewcode-back" href="../../generated/generated/gensim.utils.simple_preprocess.html#gensim.interfaces.simple_preprocess">[docs]</a><span class="k">def</span> <span class="nf">simple_preprocess</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">deacc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a document into a list of tokens.</span>

<span class="sd">    This lowercases, tokenizes, de-accents (optional). -- the output are final</span>
<span class="sd">    tokens = unicode strings, that won&#39;t be processed any further.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">deacc</span><span class="o">=</span><span class="n">deacc</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_len</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_len</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">tokens</span></div>


<div class="viewcode-block" id="any2utf8"><a class="viewcode-back" href="../../generated/generated/gensim.utils.any2utf8.html#gensim.interfaces.any2utf8">[docs]</a><span class="k">def</span> <span class="nf">any2utf8</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a string (unicode or bytestring in `encoding`), to bytestring in utf8.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
    <span class="c1"># do bytestring -&gt; unicode -&gt; utf8 full circle, to ensure valid utf8</span>
    <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span></div>
<span class="n">to_utf8</span> <span class="o">=</span> <span class="n">any2utf8</span>


<div class="viewcode-block" id="any2unicode"><a class="viewcode-back" href="../../generated/generated/gensim.utils.any2unicode.html#gensim.interfaces.any2unicode">[docs]</a><span class="k">def</span> <span class="nf">any2unicode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a string (bytestring in `encoding` or unicode), to unicode.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span></div>
<span class="n">to_unicode</span> <span class="o">=</span> <span class="n">any2unicode</span>


<div class="viewcode-block" id="SaveLoad"><a class="viewcode-back" href="../../generated/generated/gensim.utils.SaveLoad.html#gensim.interfaces.SaveLoad">[docs]</a><span class="k">class</span> <span class="nc">SaveLoad</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Objects which inherit from this class have save/load functions, which un/pickle</span>
<span class="sd">    them to disk.</span>

<span class="sd">    This uses pickle for de/serializing, so objects must not contain</span>
<span class="sd">    unpicklable attributes, such as lambda functions etc.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SaveLoad.load"><a class="viewcode-back" href="../../generated/generated/gensim.utils.SaveLoad.load.html#gensim.interfaces.SaveLoad.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a previously saved object from file (also see `save`).</span>

<span class="sd">        If the object was saved with large arrays stored separately, you can load</span>
<span class="sd">        these arrays via mmap (shared memory) using `mmap=&#39;r&#39;`. Default: don&#39;t use</span>
<span class="sd">        mmap, load large arrays as normal objects.</span>

<span class="sd">        If the file being loaded is compressed (either &#39;.gz&#39; or &#39;.bz2&#39;), then</span>
<span class="sd">        `mmap=None` must be set.  Load will raise an `IOError` if this condition</span>
<span class="sd">        is encountered.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;loading </span><span class="si">%s</span><span class="s2"> object from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>

        <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span> <span class="o">=</span> <span class="n">SaveLoad</span><span class="o">.</span><span class="n">_adapt_by_suffix</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">unpickle</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_load_specials</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>


    <span class="k">def</span> <span class="nf">_load_specials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads any attributes that were stored specially, and gives the same</span>
<span class="sd">        opportunity to recursively included SaveLoad instances.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mmap_error</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="ne">IOError</span><span class="p">(</span>
            <span class="s1">&#39;Cannot mmap compressed object </span><span class="si">%s</span><span class="s1"> in file </span><span class="si">%s</span><span class="s1">. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="s1">&#39;Use `load(fname, mmap=None)` or uncompress files manually.&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__recursive_saveloads&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">cfname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;loading </span><span class="si">%s</span><span class="s2"> recursively from </span><span class="si">%s</span><span class="s2">.* with mmap=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">attrib</span><span class="p">,</span> <span class="n">cfname</span><span class="p">,</span> <span class="n">mmap</span><span class="p">))</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span><span class="o">.</span><span class="n">_load_specials</span><span class="p">(</span><span class="n">cfname</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__numpys&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;loading </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> with mmap=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">attrib</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">mmap</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">mmap_error</span><span class="p">(</span><span class="n">attrib</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">))</span>

                <span class="n">val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">))[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">mmap_mode</span><span class="o">=</span><span class="n">mmap</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__scipys&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;loading </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> with mmap=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">attrib</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">mmap</span><span class="p">))</span>
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">unpickle</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">mmap_error</span><span class="p">(</span><span class="n">attrib</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">))</span>

                <span class="k">with</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;sparse&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">sparse</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                    <span class="n">sparse</span><span class="o">.</span><span class="n">indptr</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;indptr&#39;</span><span class="p">]</span>
                    <span class="n">sparse</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sparse</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="n">mmap_mode</span><span class="o">=</span><span class="n">mmap</span><span class="p">)</span>
                <span class="n">sparse</span><span class="o">.</span><span class="n">indptr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;indptr&#39;</span><span class="p">),</span> <span class="n">mmap_mode</span><span class="o">=</span><span class="n">mmap</span><span class="p">)</span>
                <span class="n">sparse</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;indices&#39;</span><span class="p">),</span> <span class="n">mmap_mode</span><span class="o">=</span><span class="n">mmap</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">sparse</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__ignoreds&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;setting ignored attribute </span><span class="si">%s</span><span class="s2"> to None&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrib</span><span class="p">))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_adapt_by_suffix</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Give appropriate compress setting and filename formula&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.gz&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.bz2&#39;</span><span class="p">):</span>
            <span class="n">compress</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">subname</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;npz&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compress</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">subname</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;npy&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_smart_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">separately</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sep_limit</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">ignore</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">(),</span> <span class="n">pickle_protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object to file (also see `load`).</span>

<span class="sd">        If `separately` is None, automatically detect large</span>
<span class="sd">        numpy/scipy.sparse arrays in the object being stored, and store</span>
<span class="sd">        them into separate files. This avoids pickle memory errors and</span>
<span class="sd">        allows mmap&#39;ing large arrays back on load efficiently.</span>

<span class="sd">        You can also set `separately` manually, in which case it must be</span>
<span class="sd">        a list of attribute names to be stored in separate files. The</span>
<span class="sd">        automatic check is not performed in this case.</span>

<span class="sd">        `ignore` is a set of attribute names to *not* serialize (file</span>
<span class="sd">        handles, caches etc). On subsequent load() these attributes will</span>
<span class="sd">        be set to None.</span>

<span class="sd">        `pickle_protocol` defaults to 2 so the pickled object can be imported</span>
<span class="sd">        in both Python 2 and 3.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;saving </span><span class="si">%s</span><span class="s2"> object under </span><span class="si">%s</span><span class="s2">, separately </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">separately</span><span class="p">))</span>

        <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span> <span class="o">=</span> <span class="n">SaveLoad</span><span class="o">.</span><span class="n">_adapt_by_suffix</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="n">restores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_specials</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">separately</span><span class="p">,</span> <span class="n">sep_limit</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">,</span>
                                       <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle_protocol</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># restore attribs handled specially</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">asides</span> <span class="ow">in</span> <span class="n">restores</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">asides</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_save_specials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">separately</span><span class="p">,</span> <span class="n">sep_limit</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">pickle_protocol</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save aside any attributes that need to be handled separately, including</span>
<span class="sd">        by recursion any attributes that are themselves SaveLoad instances.</span>

<span class="sd">        Returns a list of (obj, {attrib: value, ...}) settings that the caller</span>
<span class="sd">        should use to restore each object&#39;s attributes that were set aside</span>
<span class="sd">        during the default pickle().</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">asides</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sparse_matrices</span> <span class="o">=</span> <span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">separately</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">separately</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">sep_limit</span><span class="p">:</span>
                    <span class="n">separately</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">sparse_matrices</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">nnz</span> <span class="o">&gt;=</span> <span class="n">sep_limit</span><span class="p">:</span>
                    <span class="n">separately</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>

        <span class="c1"># whatever&#39;s in `separately` or `ignore` at this point won&#39;t get pickled</span>
        <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="n">separately</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ignore</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">):</span>
                <span class="n">asides</span><span class="p">[</span><span class="n">attrib</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span>

        <span class="n">recursive_saveloads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">restores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;_save_specials&#39;</span><span class="p">):</span>  <span class="c1"># better than &#39;isinstance(val, SaveLoad)&#39; if IPython reloading</span>
                <span class="n">recursive_saveloads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
                <span class="n">cfname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span><span class="n">attrib</span><span class="p">))</span>
                <span class="n">restores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">_save_specials</span><span class="p">(</span><span class="n">cfname</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sep_limit</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span>
                                                   <span class="n">pickle_protocol</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="n">subname</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">numpys</span><span class="p">,</span> <span class="n">scipys</span><span class="p">,</span> <span class="n">ignoreds</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">asides</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attrib</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
                    <span class="n">numpys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;storing numpy array &#39;</span><span class="si">%s</span><span class="s2">&#39; to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">attrib</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)))</span>

                    <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">val</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">))</span> <span class="ow">and</span> <span class="n">attrib</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
                    <span class="n">scipys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;storing scipy.sparse array &#39;</span><span class="si">%s</span><span class="s2">&#39; under </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">attrib</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)))</span>

                    <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;sparse&#39;</span><span class="p">),</span>
                                               <span class="n">data</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                               <span class="n">indptr</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span>
                                               <span class="n">indices</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;indptr&#39;</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">indptr</span><span class="p">)</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="s1">&#39;indices&#39;</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>

                    <span class="n">data</span><span class="p">,</span> <span class="n">indptr</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">indices</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># store array-less object</span>
                        <span class="n">pickle</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">subname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle_protocol</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">val</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">indptr</span><span class="p">,</span> <span class="n">indices</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;not storing attribute </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrib</span><span class="p">))</span>
                    <span class="n">ignoreds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;__numpys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;__scipys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;__ignoreds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ignoreds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;__recursive_saveloads&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recursive_saveloads</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># restore the attributes if exception-interrupted</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">asides</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">restores</span> <span class="o">+</span> <span class="p">[(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asides</span><span class="p">)]</span>


<div class="viewcode-block" id="SaveLoad.save"><a class="viewcode-back" href="../../generated/generated/gensim.utils.SaveLoad.save.html#gensim.interfaces.SaveLoad.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_or_handle</span><span class="p">,</span> <span class="n">separately</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sep_limit</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">ignore</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">(),</span> <span class="n">pickle_protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object to file (also see `load`).</span>

<span class="sd">        `fname_or_handle` is either a string specifying the file name to</span>
<span class="sd">        save to, or an open file-like object which can be written to. If</span>
<span class="sd">        the object is a file handle, no special array handling will be</span>
<span class="sd">        performed; all attributes will be saved to the same file.</span>

<span class="sd">        If `separately` is None, automatically detect large</span>
<span class="sd">        numpy/scipy.sparse arrays in the object being stored, and store</span>
<span class="sd">        them into separate files. This avoids pickle memory errors and</span>
<span class="sd">        allows mmap&#39;ing large arrays back on load efficiently.</span>

<span class="sd">        You can also set `separately` manually, in which case it must be</span>
<span class="sd">        a list of attribute names to be stored in separate files. The</span>
<span class="sd">        automatic check is not performed in this case.</span>

<span class="sd">        `ignore` is a set of attribute names to *not* serialize (file</span>
<span class="sd">        handles, caches etc). On subsequent load() these attributes will</span>
<span class="sd">        be set to None.</span>

<span class="sd">        `pickle_protocol` defaults to 2 so the pickled object can be imported</span>
<span class="sd">        in both Python 2 and 3.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname_or_handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle_protocol</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;saved </span><span class="si">%s</span><span class="s2"> object&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># `fname_or_handle` does not have write attribute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smart_save</span><span class="p">(</span><span class="n">fname_or_handle</span><span class="p">,</span> <span class="n">separately</span><span class="p">,</span> <span class="n">sep_limit</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span>
                             <span class="n">pickle_protocol</span><span class="o">=</span><span class="n">pickle_protocol</span><span class="p">)</span></div></div>
<span class="c1">#endclass SaveLoad</span>


<div class="viewcode-block" id="identity"><a class="viewcode-back" href="../../generated/generated/gensim.utils.identity.html#gensim.interfaces.identity">[docs]</a><span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Identity fnc, for flows that don&#39;t accept lambda (pickling etc).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">p</span></div>


<div class="viewcode-block" id="get_max_id"><a class="viewcode-back" href="../../generated/generated/gensim.utils.get_max_id.html#gensim.interfaces.get_max_id">[docs]</a><span class="k">def</span> <span class="nf">get_max_id</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the highest feature id that appears in the corpus.</span>

<span class="sd">    For empty corpora (no features at all), return -1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">maxid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
        <span class="n">maxid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxid</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">fieldid</span> <span class="k">for</span> <span class="n">fieldid</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">document</span><span class="p">]))</span> <span class="c1"># [-1] to avoid exceptions from max(empty)</span>
    <span class="k">return</span> <span class="n">maxid</span></div>


<div class="viewcode-block" id="FakeDict"><a class="viewcode-back" href="../../generated/generated/gensim.utils.FakeDict.html#gensim.interfaces.FakeDict">[docs]</a><span class="k">class</span> <span class="nc">FakeDict</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Objects of this class act as dictionaries that map integer-&gt;str(integer), for</span>
<span class="sd">    a specified range of integers &lt;0, num_terms).</span>

<span class="sd">    This is meant to avoid allocating real dictionaries when `num_terms` is huge, which</span>
<span class="sd">    is a waste of memory.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FakeDict.__init__"><a class="viewcode-back" href="../../generated/generated/gensim.utils.FakeDict.__init__.html#gensim.interfaces.FakeDict.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_terms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span> <span class="o">=</span> <span class="n">num_terms</span></div>


    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;FakeDict(num_terms=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span>


    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;internal id out of bounds (</span><span class="si">%s</span><span class="s2">, expected &lt;0..</span><span class="si">%s</span><span class="s2">))&quot;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span><span class="p">))</span>

<div class="viewcode-block" id="FakeDict.iteritems"><a class="viewcode-back" href="../../generated/generated/gensim.utils.FakeDict.iteritems.html#gensim.interfaces.FakeDict.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="FakeDict.keys"><a class="viewcode-back" href="../../generated/generated/gensim.utils.FakeDict.keys.html#gensim.interfaces.FakeDict.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override the dict.keys() function, which is used to determine the maximum</span>
<span class="sd">        internal id of a corpus = the vocabulary dimensionality.</span>

<span class="sd">        HACK: To avoid materializing the whole `range(0, self.num_terms)`, this returns</span>
<span class="sd">        the highest id = `[self.num_terms - 1]` only.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span>

<div class="viewcode-block" id="FakeDict.get"><a class="viewcode-back" href="../../generated/generated/gensim.utils.FakeDict.get.html#gensim.interfaces.FakeDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default</span></div></div>


<div class="viewcode-block" id="dict_from_corpus"><a class="viewcode-back" href="../../generated/generated/gensim.utils.dict_from_corpus.html#gensim.interfaces.dict_from_corpus">[docs]</a><span class="k">def</span> <span class="nf">dict_from_corpus</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scan corpus for all word ids that appear in it, then construct and return a mapping</span>
<span class="sd">    which maps each `wordId -&gt; str(wordId)`.</span>

<span class="sd">    This function is used whenever *words* need to be displayed (as opposed to just</span>
<span class="sd">    their ids) but no wordId-&gt;word mapping was provided. The resulting mapping</span>
<span class="sd">    only covers words actually used in the corpus, up to the highest wordId found.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_terms</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">get_max_id</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
    <span class="n">id2word</span> <span class="o">=</span> <span class="n">FakeDict</span><span class="p">(</span><span class="n">num_terms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">id2word</span></div>


<div class="viewcode-block" id="is_corpus"><a class="viewcode-back" href="../../generated/generated/gensim.utils.is_corpus.html#gensim.interfaces.is_corpus">[docs]</a><span class="k">def</span> <span class="nf">is_corpus</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether `obj` is a corpus. Return (is_corpus, new) 2-tuple, where</span>
<span class="sd">    `new is obj` if `obj` was an iterable, or `new` yields the same sequence as</span>
<span class="sd">    `obj` if it was an iterator.</span>

<span class="sd">    `obj` is a corpus if it supports iteration over documents, where a document</span>
<span class="sd">    is in turn anything that acts as a sequence of 2-tuples (int, float).</span>

<span class="sd">    Note: An &quot;empty&quot; corpus (empty input sequence) is ambiguous, so in this case the</span>
<span class="sd">    result is forcefully defined as `is_corpus=False`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Corpus&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">:</span>  <span class="c1"># the most common case, quick hack</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">obj</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__next__&#39;</span><span class="p">):</span>
            <span class="c1"># the input is an iterator object, meaning once we call next()</span>
            <span class="c1"># that element could be gone forever. we must be careful to put</span>
            <span class="c1"># whatever we retrieve back again</span>
            <span class="n">doc1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">doc1</span><span class="p">],</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doc1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>  <span class="c1"># empty corpus is resolved to False here</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># sparse documents must have a __len__ function (list, tuple...)</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">obj</span>  <span class="c1"># the first document is empty=&gt;assume this is a corpus</span>
        <span class="n">id1</span><span class="p">,</span> <span class="n">val1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">doc1</span><span class="p">))</span>  <span class="c1"># if obj is a numpy array, it resolves to False here</span>
        <span class="n">id1</span><span class="p">,</span> <span class="n">val1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span>  <span class="c1"># must be a 2-tuple (integer, float)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="n">obj</span>
    <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="get_my_ip"><a class="viewcode-back" href="../../generated/generated/gensim.utils.get_my_ip.html#gensim.interfaces.get_my_ip">[docs]</a><span class="k">def</span> <span class="nf">get_my_ip</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to obtain our external ip (from the pyro nameserver&#39;s point of view)</span>

<span class="sd">    This tries to sidestep the issue of bogus `/etc/hosts` entries and other</span>
<span class="sd">    local misconfigurations, which often mess up hostname resolution.</span>

<span class="sd">    If all else fails, fall back to simple `socket.gethostbyname()` lookup.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">Pyro4</span>
        <span class="c1"># we know the nameserver must exist, so use it as our anchor point</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="n">Pyro4</span><span class="o">.</span><span class="n">naming</span><span class="o">.</span><span class="n">locateNS</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ns</span><span class="o">.</span><span class="n">_pyroUri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">_pyroUri</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># see what ifconfig says about our default interface</span>
            <span class="kn">import</span> <span class="nn">commands</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;ifconfig&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># give up, leave the resolution to gethostbyname</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="RepeatCorpus"><a class="viewcode-back" href="../../generated/generated/gensim.utils.RepeatCorpus.html#gensim.interfaces.RepeatCorpus">[docs]</a><span class="k">class</span> <span class="nc">RepeatCorpus</span><span class="p">(</span><span class="n">SaveLoad</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used in the tutorial on distributed computing and likely not useful anywhere else.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RepeatCorpus.__init__"><a class="viewcode-back" href="../../generated/generated/gensim.utils.RepeatCorpus.__init__.html#gensim.interfaces.RepeatCorpus.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">reps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrap a `corpus` as another corpus of length `reps`. This is achieved by</span>
<span class="sd">        repeating documents from `corpus` over and over again, until the requested</span>
<span class="sd">        length `len(result)==reps` is reached. Repetition is done</span>
<span class="sd">        on-the-fly=efficiently, via `itertools`.</span>

<span class="sd">        &gt;&gt;&gt; corpus = [[(1, 0.5)], []] # 2 documents</span>
<span class="sd">        &gt;&gt;&gt; list(RepeatCorpus(corpus, 5)) # repeat 2.5 times to get 5 documents</span>
<span class="sd">        [[(1, 0.5)], [], [(1, 0.5)], [], [(1, 0.5)]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">corpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reps</span> <span class="o">=</span> <span class="n">reps</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">reps</span><span class="p">)</span></div>

<div class="viewcode-block" id="RepeatCorpusNTimes"><a class="viewcode-back" href="../../generated/generated/gensim.utils.RepeatCorpusNTimes.html#gensim.interfaces.RepeatCorpusNTimes">[docs]</a><span class="k">class</span> <span class="nc">RepeatCorpusNTimes</span><span class="p">(</span><span class="n">SaveLoad</span><span class="p">):</span>

<div class="viewcode-block" id="RepeatCorpusNTimes.__init__"><a class="viewcode-back" href="../../generated/generated/gensim.utils.RepeatCorpusNTimes.__init__.html#gensim.interfaces.RepeatCorpusNTimes.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeat a `corpus` `n` times.</span>

<span class="sd">        &gt;&gt;&gt; corpus = [[(1, 0.5)], []]</span>
<span class="sd">        &gt;&gt;&gt; list(RepeatCorpusNTimes(corpus, 3)) # repeat 3 times</span>
<span class="sd">        [[(1, 0.5)], [], [(1, 0.5)], [], [(1, 0.5)], []]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">corpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">document</span></div>

<div class="viewcode-block" id="ClippedCorpus"><a class="viewcode-back" href="../../generated/generated/gensim.utils.ClippedCorpus.html#gensim.interfaces.ClippedCorpus">[docs]</a><span class="k">class</span> <span class="nc">ClippedCorpus</span><span class="p">(</span><span class="n">SaveLoad</span><span class="p">):</span>
<div class="viewcode-block" id="ClippedCorpus.__init__"><a class="viewcode-back" href="../../generated/generated/gensim.utils.ClippedCorpus.__init__.html#gensim.interfaces.ClippedCorpus.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">max_docs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a corpus that is the &quot;head&quot; of input iterable `corpus`.</span>

<span class="sd">        Any documents after `max_docs` are ignored. This effectively limits the</span>
<span class="sd">        length of the returned corpus to &lt;= `max_docs`. Set `max_docs=None` for</span>
<span class="sd">        &quot;no limit&quot;, effectively wrapping the entire input corpus.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">corpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_docs</span> <span class="o">=</span> <span class="n">max_docs</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_docs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_docs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">))</span></div>

<div class="viewcode-block" id="SlicedCorpus"><a class="viewcode-back" href="../../generated/generated/gensim.utils.SlicedCorpus.html#gensim.interfaces.SlicedCorpus">[docs]</a><span class="k">class</span> <span class="nc">SlicedCorpus</span><span class="p">(</span><span class="n">SaveLoad</span><span class="p">):</span>
<div class="viewcode-block" id="SlicedCorpus.__init__"><a class="viewcode-back" href="../../generated/generated/gensim.utils.SlicedCorpus.__init__.html#gensim.interfaces.SlicedCorpus.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">slice_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a corpus that is the slice of input iterable `corpus`.</span>

<span class="sd">        Negative slicing can only be used if the corpus is indexable.</span>
<span class="sd">        Otherwise, the corpus will be iterated over.</span>

<span class="sd">        Slice can also be a numpy.ndarray to support fancy indexing.</span>

<span class="sd">        NOTE: calculating the size of a SlicedCorpus is expensive</span>
<span class="sd">        when using a slice as the corpus has to be iterated over once.</span>
<span class="sd">        Using a list or numpy.ndarray does not have this drawback, but</span>
<span class="sd">        consumes more memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">corpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_</span> <span class="o">=</span> <span class="n">slice_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">None</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">docbyoffset</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">slice_</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check cached length, calculate if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span></div>

<div class="viewcode-block" id="safe_unichr"><a class="viewcode-back" href="../../generated/generated/gensim.utils.safe_unichr.html#gensim.interfaces.safe_unichr">[docs]</a><span class="k">def</span> <span class="nf">safe_unichr</span><span class="p">(</span><span class="n">intval</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">unichr</span><span class="p">(</span><span class="n">intval</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># ValueError: unichr() arg not in range(0x10000) (narrow Python build)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">U</span><span class="si">%08x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">intval</span>
        <span class="c1"># return UTF16 surrogate pair</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;unicode-escape&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="decode_htmlentities"><a class="viewcode-back" href="../../generated/generated/gensim.utils.decode_htmlentities.html#gensim.interfaces.decode_htmlentities">[docs]</a><span class="k">def</span> <span class="nf">decode_htmlentities</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decode HTML entities in text, coded as hex, decimal or named.</span>

<span class="sd">    Adapted from http://github.com/sku/python-twitter-ircbot/blob/321d94e0e40d0acc92f5bf57d126b57369da70de/html_decode.py</span>

<span class="sd">    &gt;&gt;&gt; u = u&#39;E tu vivrai nel terrore - L&amp;#x27;aldil&amp;#xE0; (1981)&#39;</span>
<span class="sd">    &gt;&gt;&gt; print(decode_htmlentities(u).encode(&#39;UTF-8&#39;))</span>
<span class="sd">    E tu vivrai nel terrore - L&#39;aldilà (1981)</span>
<span class="sd">    &gt;&gt;&gt; print(decode_htmlentities(&quot;l&amp;#39;eau&quot;))</span>
<span class="sd">    l&#39;eau</span>
<span class="sd">    &gt;&gt;&gt; print(decode_htmlentities(&quot;foo &amp;lt; bar&quot;))</span>
<span class="sd">    foo &lt; bar</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">substitute_entity</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ent</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                <span class="c1"># decoding by number</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="c1"># number is in decimal</span>
                    <span class="k">return</span> <span class="n">safe_unichr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ent</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">]:</span>
                    <span class="c1"># number is in hex</span>
                    <span class="k">return</span> <span class="n">safe_unichr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># they were using a name</span>
                <span class="n">cp</span> <span class="o">=</span> <span class="n">n2cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cp</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">safe_unichr</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># in case of errors, return original input</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">RE_HTML_ENTITY</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">substitute_entity</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="chunkize_serial"><a class="viewcode-back" href="../../generated/generated/gensim.utils.chunkize_serial.html#gensim.interfaces.chunkize_serial">[docs]</a><span class="k">def</span> <span class="nf">chunkize_serial</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">as_numpy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return elements from the iterable in `chunksize`-ed lists. The last returned</span>
<span class="sd">    element may be smaller (if length of collection is not divisible by `chunksize`).</span>

<span class="sd">    &gt;&gt;&gt; print(list(grouper(range(10), 3)))</span>
<span class="sd">    [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">as_numpy</span><span class="p">:</span>
            <span class="c1"># convert each document to a 2d numpy array (~6x faster when transmitting</span>
            <span class="c1"># chunk data over the wire, in Pyro)</span>
            <span class="n">wrapped_chunk</span> <span class="o">=</span> <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">chunksize</span><span class="p">))]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wrapped_chunk</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)))]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped_chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">break</span>
        <span class="c1"># memory opt: wrap the chunk and then pop(), to avoid leaving behind a dangling reference</span>
        <span class="k">yield</span> <span class="n">wrapped_chunk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<span class="n">grouper</span> <span class="o">=</span> <span class="n">chunkize_serial</span>


<div class="viewcode-block" id="InputQueue"><a class="viewcode-back" href="../../generated/generated/gensim.utils.InputQueue.html#gensim.interfaces.InputQueue">[docs]</a><span class="k">class</span> <span class="nc">InputQueue</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">):</span>
<div class="viewcode-block" id="InputQueue.__init__"><a class="viewcode-back" href="../../generated/generated/gensim.utils.InputQueue.__init__.html#gensim.interfaces.InputQueue.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">as_numpy</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InputQueue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">=</span> <span class="n">maxsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">corpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="n">chunksize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_numpy</span> <span class="o">=</span> <span class="n">as_numpy</span></div>

<div class="viewcode-block" id="InputQueue.run"><a class="viewcode-back" href="../../generated/generated/gensim.utils.InputQueue.run.html#gensim.interfaces.InputQueue.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">numpy</span> <span class="c1"># don&#39;t clutter the global namespace with a dependency on numpy</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">:</span>
                <span class="c1"># HACK XXX convert documents to numpy arrays, to save memory.</span>
                <span class="c1"># This also gives a scipy warning at runtime:</span>
                <span class="c1"># &quot;UserWarning: indices array has non-integer dtype (float64)&quot;</span>
                <span class="n">wrapped_chunk</span> <span class="o">=</span> <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wrapped_chunk</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">chunk</span><span class="p">)]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped_chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">qsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                <span class="n">qsize</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;prepared another chunk of </span><span class="si">%i</span><span class="s2"> documents (qsize=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrapped_chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">qsize</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">wrapped_chunk</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div></div>
<span class="c1">#endclass InputQueue</span>


<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;detected Windows; aliasing chunkize to chunkize_serial&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chunkize</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">as_numpy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunkize_serial</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">as_numpy</span><span class="o">=</span><span class="n">as_numpy</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">chunk</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="chunkize"><a class="viewcode-back" href="../../generated/generated/gensim.utils.chunkize.html#gensim.interfaces.chunkize">[docs]</a>    <span class="k">def</span> <span class="nf">chunkize</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">as_numpy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split a stream of values into smaller chunks.</span>
<span class="sd">        Each chunk is of length `chunksize`, except the last one which may be smaller.</span>
<span class="sd">        A once-only input stream (`corpus` from a generator) is ok, chunking is done</span>
<span class="sd">        efficiently via itertools.</span>

<span class="sd">        If `maxsize &gt; 1`, don&#39;t wait idly in between successive chunk `yields`, but</span>
<span class="sd">        rather keep filling a short queue (of size at most `maxsize`) with forthcoming</span>
<span class="sd">        chunks in advance. This is realized by starting a separate process, and is</span>
<span class="sd">        meant to reduce I/O delays, which can be significant when `corpus` comes</span>
<span class="sd">        from a slow medium (like harddisk).</span>

<span class="sd">        If `maxsize==0`, don&#39;t fool around with parallelism and simply yield the chunksize</span>
<span class="sd">        via `chunkize_serial()` (no I/O optimizations).</span>

<span class="sd">        &gt;&gt;&gt; for chunk in chunkize(range(10), 4): print(chunk)</span>
<span class="sd">        [0, 1, 2, 3]</span>
<span class="sd">        [4, 5, 6, 7]</span>
<span class="sd">        [8, 9]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">chunksize</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">maxsize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">maxsize</span><span class="p">)</span>
            <span class="n">worker</span> <span class="o">=</span> <span class="n">InputQueue</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">as_numpy</span><span class="o">=</span><span class="n">as_numpy</span><span class="p">)</span>
            <span class="n">worker</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">yield</span> <span class="n">chunk</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunkize_serial</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">,</span> <span class="n">as_numpy</span><span class="o">=</span><span class="n">as_numpy</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">chunk</span></div>


<div class="viewcode-block" id="smart_extension"><a class="viewcode-back" href="../../generated/generated/gensim.utils.smart_extension.html#gensim.interfaces.smart_extension">[docs]</a><span class="k">def</span> <span class="nf">smart_extension</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">):</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">oext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">oext</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.bz2&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">oext</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">ext</span> <span class="o">+</span> <span class="s1">&#39;.bz2&#39;</span>
    <span class="k">elif</span> <span class="n">oext</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.gz&#39;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">oext</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">ext</span> <span class="o">+</span> <span class="s1">&#39;.gz&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">oext</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="pickle"><a class="viewcode-back" href="../../generated/generated/gensim.utils.pickle.html#gensim.interfaces.pickle">[docs]</a><span class="k">def</span> <span class="nf">pickle</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pickle object `obj` to file `fname`.</span>

<span class="sd">    `protocol` defaults to 2 so pickled objects are compatible across</span>
<span class="sd">    Python 2.x and 3.x.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">smart_open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>  <span class="c1"># &#39;b&#39; for binary, needed on Windows</span>
        <span class="n">_pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span></div>


<div class="viewcode-block" id="unpickle"><a class="viewcode-back" href="../../generated/generated/gensim.utils.unpickle.html#gensim.interfaces.unpickle">[docs]</a><span class="k">def</span> <span class="nf">unpickle</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load pickled object from `fname`&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">smart_open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Because of loading from S3 load can&#39;t be used (missing readline in smart_open)</span>
        <span class="k">return</span> <span class="n">_pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div>


<div class="viewcode-block" id="revdict"><a class="viewcode-back" href="../../generated/generated/gensim.utils.revdict.html#gensim.interfaces.revdict">[docs]</a><span class="k">def</span> <span class="nf">revdict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reverse a dictionary mapping.</span>

<span class="sd">    When two keys map to the same value, only one of them will be kept in the</span>
<span class="sd">    result (which one is kept is arbitrary).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">))</span></div>


<div class="viewcode-block" id="toptexts"><a class="viewcode-back" href="../../generated/generated/gensim.utils.toptexts.html#gensim.interfaces.toptexts">[docs]</a><span class="k">def</span> <span class="nf">toptexts</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Debug fnc to help inspect the top `n` most similar documents (according to a</span>
<span class="sd">    similarity index `index`), to see if they are actually related to the query.</span>

<span class="sd">    `texts` is any object that can return something insightful for each document</span>
<span class="sd">    via `texts[docid]`, such as its fulltext or snippet.</span>

<span class="sd">    Return a list of 3-tuples (docid, doc&#39;s similarity to the query, texts[docid]).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">query</span><span class="p">]</span> <span class="c1"># perform a similarity query against the corpus</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">sims</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="o">-</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">topid</span><span class="p">,</span> <span class="n">topcosine</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">[:</span><span class="n">n</span><span class="p">]:</span> <span class="c1"># only consider top-n most similar docs</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">topid</span><span class="p">,</span> <span class="n">topcosine</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">topid</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="randfname"><a class="viewcode-back" href="../../generated/generated/gensim.utils.randfname.html#gensim.interfaces.randfname">[docs]</a><span class="k">def</span> <span class="nf">randfname</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;gensim&#39;</span><span class="p">):</span>
    <span class="n">randpart</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">randpart</span><span class="p">)</span></div>


<div class="viewcode-block" id="upload_chunked"><a class="viewcode-back" href="../../generated/generated/gensim.utils.upload_chunked.html#gensim.interfaces.upload_chunked">[docs]</a><span class="k">def</span> <span class="nf">upload_chunked</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">preprocess</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Memory-friendly upload of documents to a SimServer (or Pyro SimServer proxy).</span>

<span class="sd">    Use this function to train or index large collections -- avoid sending the</span>
<span class="sd">    entire corpus over the wire as a single Pyro in-memory object. The documents</span>
<span class="sd">    will be sent in smaller chunks, of `chunksize` documents each.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">grouper</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;uploading documents </span><span class="si">%i</span><span class="s2">-</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">preprocess</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pchunk</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
                <span class="n">pchunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">pchunk</span>
        <span class="n">server</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">end</span></div>


<div class="viewcode-block" id="getNS"><a class="viewcode-back" href="../../generated/generated/gensim.utils.getNS.html#gensim.interfaces.getNS">[docs]</a><span class="k">def</span> <span class="nf">getNS</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">broadcast</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hmac_key</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a Pyro name server proxy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">Pyro4</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Pyro4</span><span class="o">.</span><span class="n">locateNS</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">broadcast</span><span class="p">,</span> <span class="n">hmac_key</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Pyro4</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">NamingError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Pyro name server not found&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyro_daemon"><a class="viewcode-back" href="../../generated/generated/gensim.utils.pyro_daemon.html#gensim.interfaces.pyro_daemon">[docs]</a><span class="k">def</span> <span class="nf">pyro_daemon</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">random_suffix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ns_conf</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register object with name server (starting the name server if not running</span>
<span class="sd">    yet) and block until the daemon is terminated. The object is registered under</span>
<span class="sd">    `name`, or `name`+ some random suffix if `random_suffix` is set.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">random_suffix</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="kn">import</span> <span class="nn">Pyro4</span>
    <span class="k">with</span> <span class="n">getNS</span><span class="p">(</span><span class="o">**</span><span class="n">ns_conf</span><span class="p">)</span> <span class="k">as</span> <span class="n">ns</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Pyro4</span><span class="o">.</span><span class="n">Daemon</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">get_my_ip</span><span class="p">(),</span> <span class="n">port</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">daemon</span><span class="p">:</span>
            <span class="c1"># register server for remote access</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="n">daemon</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> registered with nameserver (URI &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">uri</span><span class="p">))</span>
            <span class="n">daemon</span><span class="o">.</span><span class="n">requestLoop</span><span class="p">()</span></div>


<div class="viewcode-block" id="has_pattern"><a class="viewcode-back" href="../../generated/generated/gensim.utils.has_pattern.html#gensim.interfaces.has_pattern">[docs]</a><span class="k">def</span> <span class="nf">has_pattern</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to check if there is installed pattern library</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pattern.en</span> <span class="kn">import</span> <span class="n">parse</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pattern library is not installed, lemmatization won&#39;t be available.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pattern</span></div>


<div class="viewcode-block" id="lemmatize"><a class="viewcode-back" href="../../generated/generated/gensim.utils.lemmatize.html#gensim.interfaces.lemmatize">[docs]</a><span class="k">def</span> <span class="nf">lemmatize</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">allowed_tags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(NN|VB|JJ|RB)&#39;</span><span class="p">),</span> <span class="n">light</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">stopwords</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">(),</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is only available when the optional &#39;pattern&#39; package is installed.</span>

<span class="sd">    Use the English lemmatizer from `pattern` to extract UTF8-encoded tokens in</span>
<span class="sd">    their base form=lemma, e.g. &quot;are, is, being&quot; -&gt; &quot;be&quot; etc.</span>
<span class="sd">    This is a smarter version of stemming, taking word context into account.</span>

<span class="sd">    Only considers nouns, verbs, adjectives and adverbs by default (=all other lemmas are discarded).</span>

<span class="sd">    &gt;&gt;&gt; lemmatize(&#39;Hello World! How is it going?! Nonexistentword, 21&#39;)</span>
<span class="sd">    [&#39;world/NN&#39;, &#39;be/VB&#39;, &#39;go/VB&#39;, &#39;nonexistentword/NN&#39;]</span>

<span class="sd">    &gt;&gt;&gt; lemmatize(&#39;The study ranks high.&#39;)</span>
<span class="sd">    [&#39;study/NN&#39;, &#39;rank/VB&#39;, &#39;high/JJ&#39;]</span>

<span class="sd">    &gt;&gt;&gt; lemmatize(&#39;The ranks study hard.&#39;)</span>
<span class="sd">    [&#39;rank/NN&#39;, &#39;study/VB&#39;, &#39;hard/RB&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_pattern</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Pattern library is not installed. Pattern library is needed in order  </span><span class="se">\</span>
<span class="s2">         to use lemmatize function&quot;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">pattern.en</span> <span class="kn">import</span> <span class="n">parse</span>

    <span class="k">if</span> <span class="n">light</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The light flag is no longer supported by pattern.&quot;</span><span class="p">)</span>

    <span class="c1"># tokenization in `pattern` is weird; it gets thrown off by non-letters,</span>
    <span class="c1"># producing &#39;==relate/VBN&#39; or &#39;**/NN&#39;... try to preprocess the text a little</span>
    <span class="c1"># FIXME this throws away all fancy parsing cues, including sentence structure,</span>
    <span class="c1"># abbreviations etc.</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokenize</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>

    <span class="n">parsed</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">lemmata</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">parsed</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">lemma</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">min_length</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lemma</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lemma</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">allowed_tags</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                    <span class="n">lemma</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lemma</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="mock_data_row"><a class="viewcode-back" href="../../generated/generated/gensim.utils.mock_data_row.html#gensim.interfaces.mock_data_row">[docs]</a><span class="k">def</span> <span class="nf">mock_data_row</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">prob_nnz</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a random gensim sparse vector. Each coordinate is nonzero with</span>
<span class="sd">    probability `prob_nnz`, each non-zero coordinate value is drawn from</span>
<span class="sd">    a Poisson distribution with parameter lambda equal to `lam`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nnz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">dim</span><span class="p">,))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">if</span> <span class="n">nnz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prob_nnz</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="mock_data"><a class="viewcode-back" href="../../generated/generated/gensim.utils.mock_data.html#gensim.interfaces.mock_data">[docs]</a><span class="k">def</span> <span class="nf">mock_data</span><span class="p">(</span><span class="n">n_items</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">prob_nnz</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a random gensim-style corpus, as a list of lists of (int, float) tuples,</span>
<span class="sd">    to be used as a mock corpus.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">mock_data_row</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">prob_nnz</span><span class="o">=</span><span class="n">prob_nnz</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_items</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="prune_vocab"><a class="viewcode-back" href="../../generated/generated/gensim.utils.prune_vocab.html#gensim.interfaces.prune_vocab">[docs]</a><span class="k">def</span> <span class="nf">prune_vocab</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">min_reduce</span><span class="p">,</span> <span class="n">trim_rule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove all entries from the `vocab` dictionary with count smaller than `min_reduce`.</span>

<span class="sd">    Modifies `vocab` in place, returns the sum of all counts that were pruned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">old_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">vocab</span><span class="p">):</span>  <span class="c1"># make a copy of dict&#39;s keys</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_vocab_item</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">vocab</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">min_reduce</span><span class="p">,</span> <span class="n">trim_rule</span><span class="p">):</span>  <span class="c1"># vocab[w] &lt;= min_reduce:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">vocab</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">vocab</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;pruned out </span><span class="si">%i</span><span class="s2"> tokens with count &lt;=</span><span class="si">%i</span><span class="s2"> (before </span><span class="si">%i</span><span class="s2">, after </span><span class="si">%i</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">old_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="n">min_reduce</span><span class="p">,</span> <span class="n">old_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="qsize"><a class="viewcode-back" href="../../generated/generated/gensim.utils.qsize.html#gensim.interfaces.qsize">[docs]</a><span class="k">def</span> <span class="nf">qsize</span><span class="p">(</span><span class="n">queue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the (approximate) queue size where available; -1 where not (OS X).&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
        <span class="c1"># OS X doesn&#39;t support qsize</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<span class="n">RULE_DEFAULT</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">RULE_DISCARD</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RULE_KEEP</span> <span class="o">=</span> <span class="mi">2</span>


<div class="viewcode-block" id="keep_vocab_item"><a class="viewcode-back" href="../../generated/generated/gensim.utils.keep_vocab_item.html#gensim.interfaces.keep_vocab_item">[docs]</a><span class="k">def</span> <span class="nf">keep_vocab_item</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">min_count</span><span class="p">,</span> <span class="n">trim_rule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">default_res</span> <span class="o">=</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span>

    <span class="k">if</span> <span class="n">trim_rule</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default_res</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rule_res</span> <span class="o">=</span> <span class="n">trim_rule</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">min_count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rule_res</span> <span class="o">==</span> <span class="n">RULE_KEEP</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">rule_res</span> <span class="o">==</span> <span class="n">RULE_DISCARD</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_res</span></div>

<div class="viewcode-block" id="check_output"><a class="viewcode-back" href="../../generated/generated/gensim.utils.check_output.html#gensim.interfaces.check_output">[docs]</a><span class="k">def</span> <span class="nf">check_output</span><span class="p">(</span><span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;Run command with arguments and return its output as a byte string.</span>
<span class="sd">    Backported from Python 2.7 as it&#39;s implemented as pure python on stdlib.</span>
<span class="sd">    &gt;&gt;&gt; check_output([&#39;/usr/bin/python&#39;, &#39;--version&#39;])</span>
<span class="sd">    Python 2.6.2</span>
<span class="sd">    Added extra KeyboardInterrupt handling</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">unused_err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">retcode</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">retcode</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cmd</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">popenargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
            <span class="n">error</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">return</span> <span class="n">output</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">raise</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>