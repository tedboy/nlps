

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nltk.compat</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="" href="../../index.html"/>
        <link rel="up" title="nltk" href="../nltk.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> NLP APIs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gensim_tutorial/tutorial.html">Gensim Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nltk_intro.html">Natural Language Toolkit</a></li>
</ul>
<p class="caption"><span class="caption-text">Autogenerated API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../generated/nltk.html"><code class="docutils literal"><span class="pre">nltk</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.html"><code class="docutils literal"><span class="pre">gensim</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.interfaces.html"><code class="docutils literal"><span class="pre">gensim.interfaces</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.matutils.html"><code class="docutils literal"><span class="pre">gensim.matutils</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.utils.html"><code class="docutils literal"><span class="pre">gensim.utils</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.corpora.html"><code class="docutils literal"><span class="pre">gensim.corpora</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.models.html"><code class="docutils literal"><span class="pre">gensim.models</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.parsing.html"><code class="docutils literal"><span class="pre">gensim.parsing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.scripts.html"><code class="docutils literal"><span class="pre">gensim.scripts</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.similarities.html"><code class="docutils literal"><span class="pre">gensim.similarities</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.summarization.html"><code class="docutils literal"><span class="pre">gensim.summarization</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/gensim.topic_coherence.html"><code class="docutils literal"><span class="pre">gensim.topic_coherence</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/simserver.html"><code class="docutils literal"><span class="pre">simserver</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/word2vec.html"><code class="docutils literal"><span class="pre">word2vec</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/stop_words.html"><code class="docutils literal"><span class="pre">stop_words</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/nltk.classify.html"><code class="docutils literal"><span class="pre">nltk.classify</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generated/nltk.cluster.html"><code class="docutils literal"><span class="pre">nltk.cluster</span></code></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NLP APIs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../nltk.html">nltk</a> &raquo;</li>
        
      <li>nltk.compat</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nltk.compat</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Natural Language Toolkit: Compatibility</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2001-2015 NLTK Project</span>
<span class="c1">#</span>
<span class="c1"># URL: &lt;http://nltk.org/&gt;</span>
<span class="c1"># For license information, see LICENSE.TXT</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="c1"># Python 2/3 compatibility layer. Based on six.</span>

<span class="n">PY3</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
<span class="n">PY26</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="k">if</span> <span class="n">PY3</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">u</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="n">string_types</span> <span class="o">=</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">integer_types</span> <span class="o">=</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">class_types</span> <span class="o">=</span> <span class="nb">type</span><span class="p">,</span>
    <span class="n">text_type</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">binary_type</span> <span class="o">=</span> <span class="nb">bytes</span>

    <span class="n">MAXSIZE</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
    <span class="n">get_im_class</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">meth</span><span class="p">:</span> <span class="n">meth</span><span class="o">.</span><span class="n">__self__</span><span class="o">.</span><span class="n">__class__</span>
    <span class="nb">xrange</span> <span class="o">=</span> <span class="nb">range</span>
    <span class="n">_iterkeys</span> <span class="o">=</span> <span class="s2">&quot;keys&quot;</span>
    <span class="n">_itervalues</span> <span class="o">=</span> <span class="s2">&quot;values&quot;</span>
    <span class="n">_iteritems</span> <span class="o">=</span> <span class="s2">&quot;items&quot;</span>
    <span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="nb">reload</span>
    <span class="nb">raw_input</span> <span class="o">=</span> <span class="nb">input</span>

    <span class="n">imap</span> <span class="o">=</span> <span class="nb">map</span>
    <span class="n">izip</span> <span class="o">=</span> <span class="nb">zip</span>

    <span class="kn">import</span> <span class="nn">io</span>
    <span class="n">StringIO</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span>
    <span class="n">BytesIO</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span>

    <span class="kn">import</span> <span class="nn">html.entities</span> <span class="kn">as</span> <span class="nn">htmlentitydefs</span>
    <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="p">(</span><span class="n">urlopen</span><span class="p">,</span> <span class="n">ProxyHandler</span><span class="p">,</span> <span class="n">build_opener</span><span class="p">,</span>
                                <span class="n">install_opener</span><span class="p">,</span> <span class="n">getproxies</span><span class="p">,</span> <span class="n">HTTPPasswordMgrWithDefaultRealm</span><span class="p">,</span>
                                <span class="n">ProxyBasicAuthHandler</span><span class="p">,</span> <span class="n">ProxyDigestAuthHandler</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span>
                                <span class="n">url2pathname</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">URLError</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote_plus</span><span class="p">,</span> <span class="n">unquote_plus</span><span class="p">,</span> <span class="n">urlencode</span>

    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timezone</span>
    <span class="n">UTC</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>

    <span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>

    <span class="nb">unichr</span> <span class="o">=</span> <span class="nb">chr</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">int2byte</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># This is about 2x faster than the implementation above on 3.2+</span>
        <span class="kn">import</span> <span class="nn">operator</span>
        <span class="n">int2byte</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s2">&quot;to_bytes&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">u</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;unicode_escape&quot;</span><span class="p">)</span>

    <span class="n">string_types</span> <span class="o">=</span> <span class="nb">basestring</span><span class="p">,</span>
    <span class="n">integer_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)</span>
    <span class="n">class_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ClassType</span><span class="p">)</span>
    <span class="n">text_type</span> <span class="o">=</span> <span class="nb">unicode</span>
    <span class="n">binary_type</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">get_im_class</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">meth</span><span class="p">:</span> <span class="n">meth</span><span class="o">.</span><span class="n">im_class</span>
    <span class="nb">xrange</span> <span class="o">=</span> <span class="nb">xrange</span>
    <span class="n">_iterkeys</span> <span class="o">=</span> <span class="s2">&quot;iterkeys&quot;</span>
    <span class="n">_itervalues</span> <span class="o">=</span> <span class="s2">&quot;itervalues&quot;</span>
    <span class="n">_iteritems</span> <span class="o">=</span> <span class="s2">&quot;iteritems&quot;</span>
    <span class="nb">reload</span> <span class="o">=</span> <span class="nb">reload</span>
    <span class="nb">raw_input</span> <span class="o">=</span> <span class="nb">raw_input</span>

    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">imap</span><span class="p">,</span> <span class="n">izip</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">BytesIO</span> <span class="o">=</span> <span class="n">StringIO</span>

    <span class="kn">import</span> <span class="nn">htmlentitydefs</span>
    <span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="p">(</span><span class="n">urlopen</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">URLError</span><span class="p">,</span>
                         <span class="n">ProxyHandler</span><span class="p">,</span> <span class="n">build_opener</span><span class="p">,</span> <span class="n">install_opener</span><span class="p">,</span>
                         <span class="n">HTTPPasswordMgrWithDefaultRealm</span><span class="p">,</span> <span class="n">ProxyBasicAuthHandler</span><span class="p">,</span>
                         <span class="n">ProxyDigestAuthHandler</span><span class="p">,</span> <span class="n">Request</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">getproxies</span><span class="p">,</span> <span class="n">quote_plus</span><span class="p">,</span> <span class="n">unquote_plus</span><span class="p">,</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">url2pathname</span>

    <span class="c1"># Maps py2 tkinter package structure to py3 using import hook (PEP 302)</span>
    <span class="k">class</span> <span class="nc">TkinterPackage</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s2">&quot;Tkinter&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__path__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nltk_py2_tkinter_package_path&quot;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">TkinterLoader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># module name mapping from py3 to py2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;tkinter&quot;</span><span class="p">:</span> <span class="s2">&quot;Tkinter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tkinter.filedialog&quot;</span><span class="p">:</span> <span class="s2">&quot;tkFileDialog&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tkinter.font&quot;</span><span class="p">:</span> <span class="s2">&quot;tkFont&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tkinter.messagebox&quot;</span><span class="p">:</span> <span class="s2">&quot;tkMessageBox&quot;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="c1"># we are only interested in tkinter modules listed</span>
            <span class="c1"># in self.module_map</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_map</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tkinter&#39;</span><span class="p">:</span>
                    <span class="n">mod</span> <span class="o">=</span> <span class="n">TkinterPackage</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_map</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>
            <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TkinterLoader</span><span class="p">())</span>

    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">tzinfo</span><span class="p">,</span> <span class="n">timedelta</span>

    <span class="n">ZERO</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># A UTC class for python 2.7</span>
    <span class="k">class</span> <span class="nc">UTC</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;UTC&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">utcoffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ZERO</span>

        <span class="k">def</span> <span class="nf">tzname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;UTC&quot;</span>

        <span class="k">def</span> <span class="nf">dst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ZERO</span>

    <span class="n">UTC</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">()</span>

    <span class="nb">unichr</span> <span class="o">=</span> <span class="nb">unichr</span>
    <span class="n">int2byte</span> <span class="o">=</span> <span class="nb">chr</span>

    <span class="kn">import</span> <span class="nn">csv</span>
    <span class="kn">import</span> <span class="nn">codecs</span>
    <span class="kn">import</span> <span class="nn">cStringIO</span>

    <span class="k">class</span> <span class="nc">UnicodeWriter</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A CSV writer which will write rows to CSV file &quot;f&quot;,</span>
<span class="sd">        which is encoded in the given encoding.</span>
<span class="sd">        see https://docs.python.org/2/library/csv.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">excel</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="c1"># Redirect output to a queue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">dialect</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">f</span>
            <span class="n">encoder_cls</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">encoder_cls</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">data</span>

        <span class="k">def</span> <span class="nf">writerow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>
            <span class="c1"># Fetch UTF-8 output from the queue ...</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="c1"># ... and reencode it into the target encoding</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
            <span class="c1"># write to the target stream</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># empty queue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">warnings</span> <span class="kn">as</span> <span class="nn">_warnings</span>
    <span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">_os</span>
    <span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mkdtemp</span>

    <span class="k">class</span> <span class="nc">TemporaryDirectory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and return a temporary directory.  This has the same</span>
<span class="sd">        behavior as mkdtemp but can be used as a context manager.  For</span>
<span class="sd">        example:</span>

<span class="sd">            with TemporaryDirectory() as tmpdir:</span>
<span class="sd">                ...</span>

<span class="sd">        Upon exiting the context, the directory and everything contained</span>
<span class="sd">        in it are removed.</span>

<span class="sd">        http://stackoverflow.com/questions/19296146/tempfile-temporarydirectory-context-manager-in-python-2-7</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># Handle mkdtemp raising an exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;{} {!r}&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_warn</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="c1"># Issue #10188: Emit a warning on stderr</span>
                    <span class="c1"># if the directory could not be cleaned</span>
                    <span class="c1"># up due to missing globals</span>
                    <span class="k">if</span> <span class="s2">&quot;None&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">):</span>
                        <span class="k">raise</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;ERROR: {!r} while cleaning up {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="bp">self</span><span class="p">,),</span>
                          <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">_warn</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_warn</span><span class="p">(</span><span class="s2">&quot;Implicitly cleaning up {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                               <span class="n">ResourceWarning</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Issue a ResourceWarning if implicit cleanup needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="n">_warn</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># XXX (ncoghlan): The following code attempts to make</span>
        <span class="c1"># this class tolerant of the module nulling out process</span>
        <span class="c1"># that happens during CPython interpreter shutdown</span>
        <span class="c1"># Alas, it doesn&#39;t actually manage it. See issue #10188</span>
        <span class="n">_listdir</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">listdir</span><span class="p">)</span>
        <span class="n">_path_join</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
        <span class="n">_isdir</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">)</span>
        <span class="n">_islink</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">)</span>
        <span class="n">_remove</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">remove</span><span class="p">)</span>
        <span class="n">_rmdir</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">)</span>
        <span class="n">_warn</span> <span class="o">=</span> <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span>

        <span class="k">def</span> <span class="nf">_rmtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="c1"># Essentially a stripped down version of shutil.rmtree.  We can&#39;t</span>
            <span class="c1"># use globals because they may be None&#39;ed out at shutdown.</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">isdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isdir</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_islink</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="n">isdir</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">isdir</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_rmtree</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_remove</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rmdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">if</span> <span class="n">PY26</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
        <span class="kn">from</span> <span class="nn">heapq</span> <span class="kn">import</span> <span class="n">nlargest</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">ifilter</span>

        <span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Dict subclass for counting hashable objects.  Sometimes called a bag</span>
<span class="sd">            or multiset.  Elements are stored as dictionary keys and their counts</span>
<span class="sd">            are stored as dictionary values.</span>

<span class="sd">            &gt;&gt;&gt; Counter(&#39;zyzygy&#39;)</span>
<span class="sd">            Counter({&#39;y&#39;: 3, &#39;z&#39;: 2, &#39;g&#39;: 1})</span>

<span class="sd">            &#39;&#39;&#39;</span>

            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;Create a new, empty Counter object.  And if given, count elements</span>
<span class="sd">                from an input iterable.  Or, initialize the count from another mapping</span>
<span class="sd">                of elements to their counts.</span>

<span class="sd">                &gt;&gt;&gt; Counter()                           # a new, empty counter</span>
<span class="sd">                &gt;&gt;&gt; Counter(&#39;gallahad&#39;)                 # a new counter from an iterable</span>
<span class="sd">                &gt;&gt;&gt; Counter({&#39;a&#39;: 4, &#39;b&#39;: 2})           # a new counter from a mapping</span>
<span class="sd">                &gt;&gt;&gt; Counter(a=4, b=2)                   # a new counter from keyword args</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>

            <span class="k">def</span> <span class="nf">most_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;List the n most common elements and their counts from the most</span>
<span class="sd">                common to the least.  If n is None, then list all element counts.</span>

<span class="sd">                &gt;&gt;&gt; Counter(&#39;abracadabra&#39;).most_common(3)</span>
<span class="sd">                [(&#39;a&#39;, 5), (&#39;r&#39;, 2), (&#39;b&#39;, 2)]</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">nlargest</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;Iterator over elements repeating each as many times as its count.</span>

<span class="sd">                &gt;&gt;&gt; c = Counter(&#39;ABCABC&#39;)</span>
<span class="sd">                &gt;&gt;&gt; sorted(c.elements())</span>
<span class="sd">                [&#39;A&#39;, &#39;A&#39;, &#39;B&#39;, &#39;B&#39;, &#39;C&#39;, &#39;C&#39;]</span>

<span class="sd">                If an element&#39;s count has been set to zero or is a negative number,</span>
<span class="sd">                elements() will ignore it.</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">repeat</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">elem</span>

            <span class="c1"># Override dict methods where the meaning changes for Counter</span>
            <span class="c1"># objects.</span>

            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s1">&#39;Counter.fromkeys() is undefined.  Use Counter(iterable) instead.&#39;</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;Like dict.update() but add counts instead of replacing them.</span>

<span class="sd">                Source can be an iterable, a dictionary, or another Counter instance.</span>

<span class="sd">                &gt;&gt;&gt; c = Counter(&#39;which&#39;)</span>
<span class="sd">                &gt;&gt;&gt; c.update(&#39;witch&#39;)           # add elements from another iterable</span>
<span class="sd">                &gt;&gt;&gt; d = Counter(&#39;watch&#39;)</span>
<span class="sd">                &gt;&gt;&gt; c.update(d)                 # add elements from another counter</span>
<span class="sd">                &gt;&gt;&gt; c[&#39;h&#39;]                      # four &#39;h&#39; in which, witch, and watch</span>
<span class="sd">                4</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">iterable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="s1">&#39;iteritems&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
                            <span class="n">self_get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span>
                            <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">iterable</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># fast path when counter is empty</span>
                            <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">self_get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span>
                        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="s1">&#39;Like dict.copy() but returns a Counter instance instead of a dict.&#39;</span>
                <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
                <span class="s1">&#39;Like dict.__delitem__() but does not raise KeyError for missing values.&#39;</span>
                <span class="k">if</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
                <span class="n">items</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">__mod__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_common</span><span class="p">()))</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">({</span><span class="si">%s</span><span class="s1">})&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

            <span class="c1"># Multiset-style mathematical operations discussed in:</span>
            <span class="c1">#       Knuth TAOCP Volume II section 4.6.3 exercise 19</span>
            <span class="c1">#       and at http://en.wikipedia.org/wiki/Multiset</span>
            <span class="c1">#</span>
            <span class="c1"># Outputs guaranteed to only include positive counts.</span>
            <span class="c1">#</span>
            <span class="c1"># To strip negative and zero counts, add-in an empty counter:</span>
            <span class="c1">#       c += Counter()</span>

            <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;Add counts from two counters.</span>

<span class="sd">                &gt;&gt;&gt; Counter(&#39;abbb&#39;) + Counter(&#39;bcc&#39;)</span>
<span class="sd">                Counter({&#39;b&#39;: 4, &#39;c&#39;: 2, &#39;a&#39;: 1})</span>


<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">NotImplemented</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                    <span class="n">newcount</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39; Subtract count, but keep only results with positive counts.</span>

<span class="sd">                &gt;&gt;&gt; Counter(&#39;abbbc&#39;) - Counter(&#39;bccd&#39;)</span>
<span class="sd">                Counter({&#39;b&#39;: 2, &#39;a&#39;: 1})</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">NotImplemented</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                    <span class="n">newcount</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;Union is the maximum of value in either of the input counters.</span>

<span class="sd">                &gt;&gt;&gt; Counter(&#39;abbb&#39;) | Counter(&#39;bcc&#39;)</span>
<span class="sd">                Counter({&#39;b&#39;: 3, &#39;c&#39;: 2, &#39;a&#39;: 1})</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">NotImplemented</span>
                <span class="n">_max</span> <span class="o">=</span> <span class="nb">max</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                    <span class="n">newcount</span> <span class="o">=</span> <span class="n">_max</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">],</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="k">def</span> <span class="nf">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39; Intersection is the minimum of corresponding counts.</span>

<span class="sd">                &gt;&gt;&gt; Counter(&#39;abbb&#39;) &amp; Counter(&#39;bcc&#39;)</span>
<span class="sd">                Counter({&#39;b&#39;: 1})</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Counter</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">NotImplemented</span>
                <span class="n">_min</span> <span class="o">=</span> <span class="nb">min</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">ifilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__contains__</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                    <span class="n">newcount</span> <span class="o">=</span> <span class="n">_min</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">elem</span><span class="p">],</span> <span class="n">other</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">newcount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcount</span>
                <span class="k">return</span> <span class="n">result</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an iterator over the keys of a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">_iterkeys</span><span class="p">)()</span>


<span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an iterator over the values of a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">_itervalues</span><span class="p">)()</span>


<span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an iterator over the (key, value) pairs of a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">_iteritems</span><span class="p">)()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">total_ordering</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># python 2.6</span>
    <span class="k">def</span> <span class="nf">total_ordering</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Class decorator that fills in missing ordering methods&quot;&quot;&quot;</span>
        <span class="n">convert</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;__lt__&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;__gt__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)),</span>
                       <span class="p">(</span><span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;__ge__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">)],</span>
            <span class="s1">&#39;__le__&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;__ge__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;__lt__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;__gt__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="p">)],</span>
            <span class="s1">&#39;__gt__&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;__lt__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)),</span>
                       <span class="p">(</span><span class="s1">&#39;__ge__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">)],</span>
            <span class="s1">&#39;__ge__&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;__gt__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;__lt__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="p">)]</span>
        <span class="p">}</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">cls</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">convert</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">roots</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;must define at least one ordering operation: &lt; &gt; &lt;= &gt;=&#39;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>       <span class="c1"># prefer __lt__ to __le__ to __gt__ to __ge__</span>
        <span class="k">for</span> <span class="n">opname</span><span class="p">,</span> <span class="n">opfunc</span> <span class="ow">in</span> <span class="n">convert</span><span class="p">[</span><span class="n">root</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">opname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
                <span class="n">opfunc</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">opname</span>
                <span class="n">opfunc</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">opname</span><span class="p">)</span><span class="o">.</span><span class="n">__doc__</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">opname</span><span class="p">,</span> <span class="n">opfunc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span>


<span class="c1"># ======= Compatibility for datasets that care about Python versions ========</span>

<span class="c1"># The following datasets have a /PY3 subdirectory containing</span>
<span class="c1"># a full copy of the data which has been re-encoded or repickled.</span>

<span class="kn">import</span> <span class="nn">os.path</span>

<span class="n">DATA_UPDATES</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;chunkers&quot;</span><span class="p">,</span> <span class="s2">&quot;maxent_ne_chunker&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;tagsets&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;taggers&quot;</span><span class="p">,</span> <span class="s2">&quot;maxent_treebank_pos_tagger&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;tokenizers&quot;</span><span class="p">,</span> <span class="s2">&quot;punkt&quot;</span><span class="p">)]</span>

<span class="n">_PY3_DATA_UPDATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">path_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">path_list</span> <span class="ow">in</span> <span class="n">DATA_UPDATES</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">add_py3_data</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">PY3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">_PY3_DATA_UPDATES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;/PY3&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.zip&quot;</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/PY3&quot;</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="c1"># for use in adding /PY3 to the second (filename) argument</span>
<span class="c1"># of the file pointers in data.py</span>
<span class="k">def</span> <span class="nf">py3_data</span><span class="p">(</span><span class="n">init_func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">add_py3_data</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">init_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wraps</span><span class="p">(</span><span class="n">init_func</span><span class="p">)(</span><span class="n">_decorator</span><span class="p">)</span>

<span class="c1"># ======= Compatibility layer for __str__ and __repr__ ==========</span>

<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">remove_accents</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

    <span class="n">category</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span>  <span class="c1"># this gives a small (~10%) speedup</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">category</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Mn&#39;</span>
    <span class="p">)</span>

<span class="c1"># Select the best transliteration method:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Older versions of Unidecode are licensed under Artistic License;</span>
    <span class="c1"># assume an older version is installed.</span>
    <span class="kn">from</span> <span class="nn">unidecode</span> <span class="kn">import</span> <span class="n">unidecode</span> <span class="k">as</span> <span class="n">transliterate</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># text-unidecode implementation is worse than Unidecode</span>
        <span class="c1"># implementation so Unidecode is preferred.</span>
        <span class="kn">from</span> <span class="nn">text_unidecode</span> <span class="kn">import</span> <span class="n">unidecode</span> <span class="k">as</span> <span class="n">transliterate</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># This transliteration method should be enough</span>
        <span class="c1"># for many Western languages.</span>
        <span class="n">transliterate</span> <span class="o">=</span> <span class="n">remove_accents</span>


<div class="viewcode-block" id="python_2_unicode_compatible"><a class="viewcode-back" href="../../generated/generated/nltk.python_2_unicode_compatible.html#nltk.python_2_unicode_compatible">[docs]</a><span class="k">def</span> <span class="nf">python_2_unicode_compatible</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This decorator defines __unicode__ method and fixes</span>
<span class="sd">    __repr__ and __str__ methods under Python 2.</span>

<span class="sd">    To support Python 2 and 3 with a single code base,</span>
<span class="sd">    define __str__ and __repr__ methods returning unicode</span>
<span class="sd">    text and apply this decorator to the class.</span>

<span class="sd">    Original __repr__ and __str__ would be available</span>
<span class="sd">    as unicode_repr and __unicode__ (under both Python 2</span>
<span class="sd">    and Python 3).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This decorator doesn&#39;t work for old-style classes&quot;</span><span class="p">)</span>

    <span class="c1"># both __unicode__ and unicode_repr are public because they</span>
    <span class="c1"># may be useful in console under Python 2.x</span>

    <span class="c1"># if __str__ or __repr__ are not overriden in a subclass,</span>
    <span class="c1"># they may be already fixed by this decorator in a parent class</span>
    <span class="c1"># and we shouldn&#39;t them again</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_was_fixed</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">__str__</span><span class="p">):</span>
        <span class="n">klass</span><span class="o">.</span><span class="n">__unicode__</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">__str__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PY3</span><span class="p">:</span>
            <span class="n">klass</span><span class="o">.</span><span class="n">__str__</span> <span class="o">=</span> <span class="n">_7bit</span><span class="p">(</span><span class="n">_transliterated</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_was_fixed</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">__repr__</span><span class="p">):</span>
        <span class="n">klass</span><span class="o">.</span><span class="n">unicode_repr</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">__repr__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PY3</span><span class="p">:</span>
            <span class="n">klass</span><span class="o">.</span><span class="n">__repr__</span> <span class="o">=</span> <span class="n">_7bit</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">unicode_repr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">klass</span></div>


<span class="k">def</span> <span class="nf">unicode_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For classes that was fixed with @python_2_unicode_compatible</span>
<span class="sd">    ``unicode_repr`` returns ``obj.unicode_repr()``; for unicode strings</span>
<span class="sd">    the result is returned without &quot;u&quot; letter (to make output the</span>
<span class="sd">    same under Python 2.x and Python 3.x); for other variables</span>
<span class="sd">    it is the same as ``repr``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">PY3</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1"># Python 2.x</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;unicode_repr&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">unicode_repr</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># strip &quot;u&quot; letter from output</span>

    <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_transliterated</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transliterate</span><span class="p">(</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="s2">&quot;__doc__&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;_nltk_compat_7bit&quot;</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">_nltk_compat_7bit</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">_nltk_compat_7bit</span>

    <span class="n">wrapper</span><span class="o">.</span><span class="n">_nltk_compat_transliterated</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">_7bit</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;backslashreplace&#39;</span><span class="p">)</span>

    <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="s2">&quot;__doc__&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;_nltk_compat_transliterated&quot;</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">_nltk_compat_transliterated</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">_nltk_compat_transliterated</span>

    <span class="n">wrapper</span><span class="o">.</span><span class="n">_nltk_compat_7bit</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">_was_fixed</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;_nltk_compat_7bit&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">or</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;_nltk_compat_transliterated&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>