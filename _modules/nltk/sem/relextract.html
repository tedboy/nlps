

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nltk.sem.relextract</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="" href="../../../index.html"/>
        <link rel="up" title="nltk" href="../../nltk.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> NLP APIs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gensim_tutorial/tutorial.html">Gensim Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nltk_intro.html">Natural Language Toolkit</a></li>
</ul>
<p class="caption"><span class="caption-text">Autogenerated API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/nltk.html"><code class="docutils literal"><span class="pre">nltk</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.html"><code class="docutils literal"><span class="pre">gensim</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.interfaces.html"><code class="docutils literal"><span class="pre">gensim.interfaces</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.matutils.html"><code class="docutils literal"><span class="pre">gensim.matutils</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.utils.html"><code class="docutils literal"><span class="pre">gensim.utils</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.corpora.html"><code class="docutils literal"><span class="pre">gensim.corpora</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.models.html"><code class="docutils literal"><span class="pre">gensim.models</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.parsing.html"><code class="docutils literal"><span class="pre">gensim.parsing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.scripts.html"><code class="docutils literal"><span class="pre">gensim.scripts</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.similarities.html"><code class="docutils literal"><span class="pre">gensim.similarities</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.summarization.html"><code class="docutils literal"><span class="pre">gensim.summarization</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gensim.topic_coherence.html"><code class="docutils literal"><span class="pre">gensim.topic_coherence</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/simserver.html"><code class="docutils literal"><span class="pre">simserver</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/word2vec.html"><code class="docutils literal"><span class="pre">word2vec</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/stop_words.html"><code class="docutils literal"><span class="pre">stop_words</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/nltk.classify.html"><code class="docutils literal"><span class="pre">nltk.classify</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/nltk.cluster.html"><code class="docutils literal"><span class="pre">nltk.cluster</span></code></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NLP APIs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../nltk.html">nltk</a> &raquo;</li>
        
      <li>nltk.sem.relextract</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nltk.sem.relextract</h1><div class="highlight"><pre>
<span></span><span class="c1"># Natural Language Toolkit: Relation Extraction</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2001-2015 NLTK Project</span>
<span class="c1"># Author: Ewan Klein &lt;ewan@inf.ed.ac.uk&gt;</span>
<span class="c1"># URL: &lt;http://nltk.org/&gt;</span>
<span class="c1"># For license information, see LICENSE.TXT</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Code for extracting relational triples from the ieer and conll2002 corpora.</span>

<span class="sd">Relations are stored internally as dictionaries (&#39;reldicts&#39;).</span>

<span class="sd">The two serialization outputs are &quot;rtuple&quot; and &quot;clause&quot;.</span>

<span class="sd">- An rtuple is a tuple of the form ``(subj, filler, obj)``,</span>
<span class="sd">  where ``subj`` and ``obj`` are pairs of Named Entity mentions, and ``filler`` is the string of words</span>
<span class="sd">  occurring between ``sub`` and ``obj`` (with no intervening NEs). Strings are printed via ``repr()`` to</span>
<span class="sd">  circumvent locale variations in rendering utf-8 encoded strings.</span>
<span class="sd">- A clause is an atom of the form ``relsym(subjsym, objsym)``,</span>
<span class="sd">  where the relation, subject and object have been canonicalized to single strings.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="c1"># todo: get a more general solution to canonicalized symbols for clauses -- maybe use xmlcharrefs?</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">nltk.compat</span> <span class="kn">import</span> <span class="n">htmlentitydefs</span>

<span class="c1"># Dictionary that associates corpora with NE classes</span>
<span class="n">NE_CLASSES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ieer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;LOCATION&#39;</span><span class="p">,</span> <span class="s1">&#39;ORGANIZATION&#39;</span><span class="p">,</span> <span class="s1">&#39;PERSON&#39;</span><span class="p">,</span> <span class="s1">&#39;DURATION&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DATE&#39;</span><span class="p">,</span> <span class="s1">&#39;CARDINAL&#39;</span><span class="p">,</span> <span class="s1">&#39;PERCENT&#39;</span><span class="p">,</span> <span class="s1">&#39;MONEY&#39;</span><span class="p">,</span> <span class="s1">&#39;MEASURE&#39;</span><span class="p">],</span>
    <span class="s1">&#39;conll2002&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="s1">&#39;PER&#39;</span><span class="p">,</span> <span class="s1">&#39;ORG&#39;</span><span class="p">],</span>
    <span class="s1">&#39;ace&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;LOCATION&#39;</span><span class="p">,</span> <span class="s1">&#39;ORGANIZATION&#39;</span><span class="p">,</span> <span class="s1">&#39;PERSON&#39;</span><span class="p">,</span> <span class="s1">&#39;DURATION&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DATE&#39;</span><span class="p">,</span> <span class="s1">&#39;CARDINAL&#39;</span><span class="p">,</span> <span class="s1">&#39;PERCENT&#39;</span><span class="p">,</span> <span class="s1">&#39;MONEY&#39;</span><span class="p">,</span> <span class="s1">&#39;MEASURE&#39;</span><span class="p">,</span> <span class="s1">&#39;FACILITY&#39;</span><span class="p">,</span> <span class="s1">&#39;GPE&#39;</span><span class="p">],</span>
    <span class="p">}</span>

<span class="c1"># Allow abbreviated class labels</span>
<span class="n">short2long</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">LOC</span> <span class="o">=</span> <span class="s1">&#39;LOCATION&#39;</span><span class="p">,</span> <span class="n">ORG</span> <span class="o">=</span> <span class="s1">&#39;ORGANIZATION&#39;</span><span class="p">,</span> <span class="n">PER</span> <span class="o">=</span> <span class="s1">&#39;PERSON&#39;</span><span class="p">)</span>
<span class="n">long2short</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">LOCATION</span> <span class="o">=</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="n">ORGANIZATION</span> <span class="o">=</span> <span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="n">PERSON</span> <span class="o">=</span> <span class="s1">&#39;PER&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expand an NE class name.</span>
<span class="sd">    :type type: str</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">short2long</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span>

<span class="k">def</span> <span class="nf">class_abbrev</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abbreviate an NE class name.</span>
<span class="sd">    :type type: str</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">long2short</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span>


<span class="k">def</span> <span class="nf">_join</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">untag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Join a list into a string, turning tags tuples into tag strings or just words.</span>
<span class="sd">    :param untag: if ``True``, omit the tag from tagged input strings.</span>
<span class="sd">    :type lst: list</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">untag</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">nltk.tag</span> <span class="kn">import</span> <span class="n">tuple2str</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tuple2str</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">descape_entity</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">defs</span><span class="o">=</span><span class="n">htmlentitydefs</span><span class="o">.</span><span class="n">entitydefs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate one entity to its ISO Latin value.</span>
<span class="sd">    Inspired by example from effbot.org</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#s = &#39;mcglashan_&amp;amp;_sarrail&#39;</span>
    <span class="c1">#l = [&#39;mcglashan&#39;, &#39;&amp;amp;&#39;, &#39;sarrail&#39;]</span>
    <span class="c1">#pattern = re.compile(&quot;&amp;(\w+?);&quot;)</span>
    <span class="c1">#new = list2sym(l)</span>
    <span class="c1">#s = pattern.sub(descape_entity, s)</span>
    <span class="c1">#print s, new</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">defs</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># use as is</span>

<span class="k">def</span> <span class="nf">list2sym</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a list of strings into a canonical symbol.</span>
<span class="sd">    :type lst: list</span>
<span class="sd">    :return: a Unicode string without whitespace</span>
<span class="sd">    :rtype: unicode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">untag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">ENT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&amp;(\w+?);&quot;</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">ENT</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">descape_entity</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sym</span>

<span class="k">def</span> <span class="nf">tree2semi_rel</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Group a chunk structure into a list of &#39;semi-relations&#39; of the form (list(str), ``Tree``). </span>

<span class="sd">    In order to facilitate the construction of (``Tree``, string, ``Tree``) triples, this</span>
<span class="sd">    identifies pairs whose first member is a list (possibly empty) of terminal</span>
<span class="sd">    strings, and whose second member is a ``Tree`` of the form (NE_label, terminals).</span>

<span class="sd">    :param tree: a chunk tree</span>
<span class="sd">    :return: a list of pairs (list(str), ``Tree``)</span>
<span class="sd">    :rtype: list of tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">nltk.tree</span> <span class="kn">import</span> <span class="n">Tree</span>

    <span class="n">semi_rels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">semi_rel</span> <span class="o">=</span> <span class="p">[[],</span> <span class="bp">None</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">dtr</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtr</span><span class="p">,</span> <span class="n">Tree</span><span class="p">):</span>
            <span class="n">semi_rel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dtr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># dtr is a Tree</span>
            <span class="n">semi_rel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtr</span>
            <span class="n">semi_rels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">semi_rel</span><span class="p">)</span>
            <span class="n">semi_rel</span> <span class="o">=</span> <span class="p">[[],</span> <span class="bp">None</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">semi_rels</span>


<span class="k">def</span> <span class="nf">semi_rel2reldict</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the pairs generated by ``tree2semi_rel`` into a &#39;reldict&#39;: a dictionary which</span>
<span class="sd">    stores information about the subject and object NEs plus the filler between them.</span>
<span class="sd">    Additionally, a left and right context of length =&lt; window are captured (within</span>
<span class="sd">    a given input sentence).</span>

<span class="sd">    :param pairs: a pair of list(str) and ``Tree``, as generated by</span>
<span class="sd">    :param window: a threshold for the number of items to include in the left and right context</span>
<span class="sd">    :type window: int</span>
<span class="sd">    :return: &#39;relation&#39; dictionaries whose keys are &#39;lcon&#39;, &#39;subjclass&#39;, &#39;subjtext&#39;, &#39;subjsym&#39;, &#39;filler&#39;, objclass&#39;, objtext&#39;, &#39;objsym&#39; and &#39;rcon&#39;</span>
<span class="sd">    :rtype: list(defaultdict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">reldict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;lcon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">window</span><span class="p">:])</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjclass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjtext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjsym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list2sym</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;filler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;untagged_filler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">untag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objclass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objtext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objsym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list2sym</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
        <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;rcon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_join</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="n">window</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;untagged_filler&#39;</span><span class="p">],</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjclass&#39;</span><span class="p">],</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objclass&#39;</span><span class="p">]))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reldict</span><span class="p">)</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="extract_rels"><a class="viewcode-back" href="../../../generated/generated/nltk.extract_rels.html#nltk.extract_rels">[docs]</a><span class="k">def</span> <span class="nf">extract_rels</span><span class="p">(</span><span class="n">subjclass</span><span class="p">,</span> <span class="n">objclass</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s1">&#39;ace&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter the output of ``semi_rel2reldict`` according to specified NE classes and a filler pattern.</span>

<span class="sd">    The parameters ``subjclass`` and ``objclass`` can be used to restrict the</span>
<span class="sd">    Named Entities to particular types (any of &#39;LOCATION&#39;, &#39;ORGANIZATION&#39;,</span>
<span class="sd">    &#39;PERSON&#39;, &#39;DURATION&#39;, &#39;DATE&#39;, &#39;CARDINAL&#39;, &#39;PERCENT&#39;, &#39;MONEY&#39;, &#39;MEASURE&#39;).</span>

<span class="sd">    :param subjclass: the class of the subject Named Entity.</span>
<span class="sd">    :type subjclass: str</span>
<span class="sd">    :param objclass: the class of the object Named Entity.</span>
<span class="sd">    :type objclass: str</span>
<span class="sd">    :param doc: input document</span>
<span class="sd">    :type doc: ieer document or a list of chunk trees</span>
<span class="sd">    :param corpus: name of the corpus to take as input; possible values are</span>
<span class="sd">        &#39;ieer&#39; and &#39;conll2002&#39;</span>
<span class="sd">    :type corpus: str</span>
<span class="sd">    :param pattern: a regular expression for filtering the fillers of</span>
<span class="sd">        retrieved triples.</span>
<span class="sd">    :type pattern: SRE_Pattern</span>
<span class="sd">    :param window: filters out fillers which exceed this threshold</span>
<span class="sd">    :type window: int</span>
<span class="sd">    :return: see ``mk_reldicts``</span>
<span class="sd">    :rtype: list(defaultdict)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subjclass</span> <span class="ow">and</span> <span class="n">subjclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_expand</span><span class="p">(</span><span class="n">subjclass</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
            <span class="n">subjclass</span> <span class="o">=</span> <span class="n">_expand</span><span class="p">(</span><span class="n">subjclass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;your value for the subject type has not been recognized: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">subjclass</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">objclass</span> <span class="ow">and</span> <span class="n">objclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_expand</span><span class="p">(</span><span class="n">objclass</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NE_CLASSES</span><span class="p">[</span><span class="n">corpus</span><span class="p">]:</span>
            <span class="n">objclass</span> <span class="o">=</span> <span class="n">_expand</span><span class="p">(</span><span class="n">objclass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;your value for the object type has not been recognized: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">objclass</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">corpus</span> <span class="o">==</span> <span class="s1">&#39;ace&#39;</span> <span class="ow">or</span> <span class="n">corpus</span> <span class="o">==</span> <span class="s1">&#39;conll2002&#39;</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">tree2semi_rel</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">corpus</span> <span class="o">==</span> <span class="s1">&#39;ieer&#39;</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">tree2semi_rel</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="n">tree2semi_rel</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;corpus type not recognized&quot;</span><span class="p">)</span>

    <span class="n">reldicts</span> <span class="o">=</span> <span class="n">semi_rel2reldict</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>

    <span class="n">relfilter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;subjclass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subjclass</span> <span class="ow">and</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;filler&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">window</span> <span class="ow">and</span>
                           <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;filler&#39;</span><span class="p">])</span> <span class="ow">and</span>
                           <span class="n">x</span><span class="p">[</span><span class="s1">&#39;objclass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objclass</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">relfilter</span><span class="p">,</span> <span class="n">reldicts</span><span class="p">))</span></div>


<div class="viewcode-block" id="rtuple"><a class="viewcode-back" href="../../../generated/generated/nltk.rtuple.html#nltk.rtuple">[docs]</a><span class="k">def</span> <span class="nf">rtuple</span><span class="p">(</span><span class="n">reldict</span><span class="p">,</span> <span class="n">lcon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rcon</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty print the reldict as an rtuple.</span>
<span class="sd">    :param reldict: a relation dictionary</span>
<span class="sd">    :type reldict: defaultdict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_abbrev</span><span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjclass&#39;</span><span class="p">]),</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjtext&#39;</span><span class="p">],</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;filler&#39;</span><span class="p">],</span> <span class="n">class_abbrev</span><span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objclass&#39;</span><span class="p">]),</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objtext&#39;</span><span class="p">]]</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">] </span><span class="si">%r</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">]&#39;</span>
    <span class="k">if</span> <span class="n">lcon</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;lcon&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">items</span>
        <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;...</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">+</span> <span class="n">format</span>
    <span class="k">if</span> <span class="n">rcon</span><span class="p">:</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;rcon&#39;</span><span class="p">])</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">format</span> <span class="o">+</span> <span class="s1">&#39;(</span><span class="si">%r</span><span class="s1">...&#39;</span>
    <span class="n">printargs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">format</span> <span class="o">%</span> <span class="n">printargs</span></div>

<div class="viewcode-block" id="clause"><a class="viewcode-back" href="../../../generated/generated/nltk.clause.html#nltk.clause">[docs]</a><span class="k">def</span> <span class="nf">clause</span><span class="p">(</span><span class="n">reldict</span><span class="p">,</span> <span class="n">relsym</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the relation in clausal form.</span>
<span class="sd">    :param reldict: a relation dictionary</span>
<span class="sd">    :type reldict: defaultdict</span>
<span class="sd">    :param relsym: a label for the relation</span>
<span class="sd">    :type relsym: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">relsym</span><span class="p">,</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;subjsym&#39;</span><span class="p">],</span> <span class="n">reldict</span><span class="p">[</span><span class="s1">&#39;objsym&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">items</span></div>


<span class="c1">#######################################################</span>
<span class="c1"># Demos of relation extraction with regular expressions</span>
<span class="c1">#######################################################</span>

<span class="c1">############################################</span>
<span class="c1"># Example of in(ORG, LOC)</span>
<span class="c1">############################################</span>
<span class="k">def</span> <span class="nf">in_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sql</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select pairs of organizations and locations whose mentions occur with an</span>
<span class="sd">    intervening occurrence of the preposition &quot;in&quot;.</span>

<span class="sd">    If the sql parameter is set to True, then the entity pairs are loaded into</span>
<span class="sd">    an in-memory database, and subsequently pulled out using an SQL &quot;SELECT&quot;</span>
<span class="sd">    query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">ieer</span>
    <span class="k">if</span> <span class="n">sql</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">sqlite3</span>
            <span class="n">connection</span> <span class="o">=</span>  <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">text_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">OptimizedUnicode</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;create table Locations</span>
<span class="s2">            (OrgName text, LocationName text, DocID text)&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">warnings</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot import sqlite; sql flag will be ignored.&quot;</span><span class="p">)</span>


    <span class="n">IN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;.*\bin\b(?!\b.+ing)&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;IEER: in(ORG, LOC) -- just the clauses:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>

    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">fileids</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">parsed_docs</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s1">&#39;ieer&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">IN</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="n">clause</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">relsym</span><span class="o">=</span><span class="s1">&#39;IN&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">sql</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rtuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;subjtext&#39;</span><span class="p">],</span> <span class="n">rel</span><span class="p">[</span><span class="s1">&#39;objtext&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">)</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;insert into Locations</span>
<span class="s2">                                    values (?, ?, ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">rtuple</span><span class="p">)</span>
                        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">sql</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;select OrgName from Locations</span>
<span class="s2">                        where LocationName = &#39;Atlanta&#39;&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Extract data from SQL table: ORGs in Atlanta&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="c1">############################################</span>
<span class="c1"># Example of has_role(PER, LOC)</span>
<span class="c1">############################################</span>

<span class="k">def</span> <span class="nf">roles_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">ieer</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (.*(                   # assorted roles</span>
<span class="s2">    analyst|</span>
<span class="s2">    chair(wo)?man|</span>
<span class="s2">    commissioner|</span>
<span class="s2">    counsel|</span>
<span class="s2">    director|</span>
<span class="s2">    economist|       </span>
<span class="s2">    editor|</span>
<span class="s2">    executive|</span>
<span class="s2">    foreman|</span>
<span class="s2">    governor|</span>
<span class="s2">    head|</span>
<span class="s2">    lawyer|</span>
<span class="s2">    leader|</span>
<span class="s2">    librarian).*)|</span>
<span class="s2">    manager|</span>
<span class="s2">    partner|</span>
<span class="s2">    president|</span>
<span class="s2">    producer|</span>
<span class="s2">    professor|</span>
<span class="s2">    researcher|</span>
<span class="s2">    spokes(wo)?man|</span>
<span class="s2">    writer|</span>
<span class="s2">    ,\sof\sthe?\s*  # &quot;X, of (the) Y&quot;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">ROLES</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">roles</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>

    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;IEER: has_role(PER, ORG) -- raw rtuples:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>

    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">fileids</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">parsed_docs</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
            <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
                <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s1">&#39;PER&#39;</span><span class="p">,</span> <span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s1">&#39;ieer&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">ROLES</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="n">rtuple</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">lcon</span><span class="o">=</span><span class="n">lcon</span><span class="p">,</span> <span class="n">rcon</span><span class="o">=</span><span class="n">rcon</span><span class="p">))</span>


<span class="c1">##############################################</span>
<span class="c1">### Show what&#39;s in the IEER Headlines</span>
<span class="c1">##############################################</span>


<span class="k">def</span> <span class="nf">ieer_headlines</span><span class="p">():</span>

    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">ieer</span>
    <span class="kn">from</span> <span class="nn">nltk.tree</span> <span class="kn">import</span> <span class="n">Tree</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;IEER: First 20 Headlines&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>  
    
    <span class="n">trees</span> <span class="o">=</span> <span class="p">[(</span><span class="n">doc</span><span class="o">.</span><span class="n">docno</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span> <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">fileids</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ieer</span><span class="o">.</span><span class="n">parsed_docs</span><span class="p">(</span><span class="nb">file</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tree</span><span class="p">)</span>



<span class="c1">#############################################</span>
<span class="c1">## Dutch CONLL2002: take_on_role(PER, ORG</span>
<span class="c1">#############################################</span>

<span class="k">def</span> <span class="nf">conllned</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the copula+&#39;van&#39; relation (&#39;of&#39;) in the Dutch tagged training corpus</span>
<span class="sd">    from CoNLL 2002.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">conll2002</span>

    <span class="n">vnv</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (</span>
<span class="s2">    is/V|    # 3rd sing present and</span>
<span class="s2">    was/V|   # past forms of the verb zijn (&#39;be&#39;)</span>
<span class="s2">    werd/V|  # and also present</span>
<span class="s2">    wordt/V  # past of worden (&#39;become)</span>
<span class="s2">    )</span>
<span class="s2">    .*       # followed by anything</span>
<span class="s2">    van/Prep # followed by van (&#39;of&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">VAN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">vnv</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>

    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dutch CoNLL2002: van(PER, ORG) -- raw rtuples with context:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">conll2002</span><span class="o">.</span><span class="n">chunked_sents</span><span class="p">(</span><span class="s1">&#39;ned.train&#39;</span><span class="p">):</span>
        <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="n">lcon</span> <span class="o">=</span> <span class="n">rcon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s1">&#39;PER&#39;</span><span class="p">,</span> <span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s1">&#39;conll2002&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">VAN</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">rtuple</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">lcon</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rcon</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="c1">#############################################</span>
<span class="c1">## Spanish CONLL2002: (PER, ORG)</span>
<span class="c1">#############################################</span>

<span class="k">def</span> <span class="nf">conllesp</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">conll2002</span>

    <span class="n">de</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    .*</span>
<span class="s2">    (</span>
<span class="s2">    de/SP|</span>
<span class="s2">    del/SP</span>
<span class="s2">    )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">DE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">de</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>

    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Spanish CoNLL2002: de(ORG, LOC) -- just the first 10 clauses:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
    <span class="n">rels</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">conll2002</span><span class="o">.</span><span class="n">chunked_sents</span><span class="p">(</span><span class="s1">&#39;esp.train&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s1">&#39;conll2002&#39;</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">DE</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">clause</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">relsym</span><span class="o">=</span><span class="s1">&#39;DE&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">ne_chunked</span><span class="p">():</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;1500 Sentences from Penn Treebank, as processed by NLTK NE Chunker&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
    <span class="n">ROLE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;.*(chairman|president|trader|scientist|economist|analyst|partner).*&#39;</span><span class="p">)</span>
    <span class="n">rels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">treebank</span><span class="o">.</span><span class="n">tagged_sents</span><span class="p">()[:</span><span class="mi">1500</span><span class="p">]):</span>
        <span class="n">sent</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">ne_chunk</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
        <span class="n">rels</span> <span class="o">=</span> <span class="n">extract_rels</span><span class="p">(</span><span class="s1">&#39;PER&#39;</span><span class="p">,</span> <span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">corpus</span><span class="o">=</span><span class="s1">&#39;ace&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">ROLE</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:&lt;5}{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rtuple</span><span class="p">(</span><span class="n">rel</span><span class="p">)))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">nltk</span>
    <span class="kn">from</span> <span class="nn">nltk.sem</span> <span class="kn">import</span> <span class="n">relextract</span>
    <span class="n">in_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">roles_demo</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">conllned</span><span class="p">()</span>
    <span class="n">conllesp</span><span class="p">()</span>
    <span class="n">ieer_headlines</span><span class="p">()</span>
    <span class="n">ne_chunked</span><span class="p">()</span>








</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>